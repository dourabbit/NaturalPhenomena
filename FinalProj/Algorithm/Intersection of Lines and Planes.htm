
<!-- saved from url=(0064)http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta http-equiv="Content-Language" content="en-us">

<meta http-equiv="reply-to" content="webmaster@softsurfer.com">
<title>Intersection of Lines and Planes</title>
<meta name="description" content="Algorithms for the Intersection of Lines, Segments and Planes in 2D and 3D.">
<meta name="keywords" content="geometry, algorithm, C++, software, computational geometry, mathematics, 2D, 3D, intersection, point, line, segment, ray, triangle, polygon, plane, two planes, three planes, perp product">
<meta name="classification" content="Internet">
<meta name="distribution" content="GLOBAL">
<meta name="rating" content="SAFE FOR KIDS">
<meta name="copyright" content="2001 SoftSurfer Company">
<meta name="author" content="Dan Sunday">
<meta name="robots" content="INDEX, NOFOLLOW">
<meta name="revisit-after" content="30 days">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">









<!--mstheme--><link rel="stylesheet" type="text/css" href="./Intersection of Lines and Planes_files/geom1011.css"><meta name="Microsoft Theme" content="geometry 1011">
<meta name="Microsoft Border" content="tb, default">
</head>

<body><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td>

<p align="left"><font size="6"><strong><a href="http://softsurfer.com/index.html">
<img border="0" src="./Intersection of Lines and Planes_files/Logo_SS.com-sm.png" align="left" hspace="30" width="85" height="70"></a>Algorithm 5</strong></font><br>
<nobr>[<a href="http://softsurfer.com/" target="" style="{text-decoration: none;}">Home</a>]</nobr>&nbsp;<nobr>[<a href="http://softsurfer.com/overview.htm" target="" style="{text-decoration: none;}">Overview</a>]</nobr>&nbsp;<nobr>[<a href="http://softsurfer.com/history.htm" target="" style="{text-decoration: none;}">History</a>]</nobr>&nbsp;<nobr>[<a href="http://softsurfer.com/algorithm_archive.htm" target="" style="{text-decoration: none;}">Algorithms</a>]</nobr>&nbsp;<nobr>[<a href="http://softsurfer.com/books.shtml" target="" style="{text-decoration: none;}">Books</a>]</nobr>&nbsp;<nobr>[<a href="http://softsurfer.com/websites.htm" target="" style="{text-decoration: none;}">Web&nbsp;Sites</a>]</nobr>&nbsp;<nobr>[<a href="http://softsurfer.com/gifts.htm" target="" style="{text-decoration: none;}">Gift&nbsp;Shop</a>]</nobr></p>

</td></tr><!--msnavigation--></tbody></table><!--msnavigation--><table dir="ltr" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><!--msnavigation--><td valign="top">

<h1 align="center" style="text-align: center"><b><u>
<font color="#800080" size="5"><br>
</font><font color="#800080">Intersections of Lines, Segments <br>
and Planes (2D and 3D)</font></u></b></h1>
<p align="center" style="text-align: center">by Dan Sunday</p>
<div align="center">
  <center>
  <table border="0">
    <tbody><tr>
      <td align="left"><b><u><a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#Line Intersections">Line and Segment 
      Intersections</a></u></b></td>
    </tr>
    <tr>
      <td align="left"><b><a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#Plane Intersections">Plane Intersections</a></b></td>
    </tr>
    <tr>
      <td align="left"><font size="2">
      <img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5"></font><b><a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#Line-Plane Intersection"><font size="2">Line-Plane 
      Intersection</font></a></b></td>
    </tr>
    <tr>
      <td align="left"><font size="2">
      <img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5"><b><a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#Intersection of 2 Planes">Intersection 
      of 2 Planes</a></b></font></td>
    </tr>
    <tr>
      <td align="left"><font size="2">
      <img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5"><b><a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#Intersection of 3 Planes">Intersection 
      of 3 Planes</a></b></font></td>
    </tr>
    <tr>
      <td align="left"><b><font color="#800080"><u><a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#Implementations">
      Implementations</a></u></font></b></td>
    </tr>
    <tr>
      <td align="left"><font size="2">
      <img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5"></font><a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#intersect2D_SegSeg()"><font face="Courier" size="2">intersect2D_2Segments()</font></a></td>
    </tr>
    <tr>
      <td align="left"><font size="2">
      <img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5"></font><font face="Courier" size="2"><a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#inSegment()">inSegment()</a></font></td>
    </tr>
    <tr>
      <td align="left"><font size="2">
      <img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5"></font><font face="Courier" size="2"><a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#intersect3D_SegPlane()">intersect3D_SegmentPlane()</a></font></td>
    </tr>
    <tr>
      <td align="left"><font size="2">
      <img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5"></font><u><font face="Courier" size="2"><a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#intersect3D_2Planes()">intersect3D_2Planes()</a></font></u></td>
    </tr>
    <tr>
      <td align="left"><b><font color="#800080"><u><a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#References">
      References</a></u></font></b></td>
    </tr>
  </tbody></table>
  </center>
</div>
<p align="left">The intersection of geometric primitives is a fundamental 
construct in many computer graphics and modeling applications ([Foley et al, 
1996], [Mortenson, 1990], [O'Rourke, 1998]).&nbsp; Here we look at the 
algorithms for the simplest 2D and 3D linear primitives: lines, segments and 
planes.</p>
<h2 style="text-align: left"><b><a name="Line Intersections"></a>Line and 
Segment Intersections</b></h2>
<p style="text-align: left">For computing intersections of lines and segments in 
2D and 3D, it is best to use the parametric equation representation.&nbsp; Other 
representations are discussed in Algorithm 2 about the
<font color="#800080" size="3"><a href="http://softsurfer.com/Archive/algorithm_0102/algorithm_0102.htm">
Distance of a Point to a Line, Ray or Segment</a></font>.&nbsp; It is shown 
there how to convert from other representations to the parametric one.&nbsp;</p>
<p align="left">In any dimension, the parametric equation of a line defined by 
two points <font color="#000000">P<sub>0</sub> </font>and <font color="#000000">
P<sub>1</sub></font> can be written as</p>
<p align="center"><font color="#000000">P(s) = P<sub>0 </sub>+ <i>s </i>(P<sub>1</sub><font face="Symbol">-</font>P<sub>0</sub>) 
= P<sub>0 </sub>+ <i>s </i><b>u</b></font>,</p>
<p align="left">where the parameter <font color="#000000"><i>s</i></font> is a 
real number and <font color="#000000"><b>u</b>=P<sub>1</sub><font face="Symbol">-</font>P<sub>0</sub></font> 
is a line direction vector.&nbsp; Using this representation
<font color="#000000">P(0)=P<sub>0</sub>, P(1)=P<sub>1</sub>, </font>and when
<font color="#000000">0&lt;<i>s</i>&lt;1,</font> <font color="#000000">P(<i>s</i>)</font> 
is a point on the finite segment between <font color="#000000">P<sub>0</sub></font> 
and <font color="#000000">P<sub>1</sub></font> where <font color="#000000"><i>s</i></font> 
is the fraction of <font color="#000000">P(<i>s</i>)</font>'s distance along the 
whole <font color="#000000">P<sub>0</sub>P<sub>1</sub></font> line segment.&nbsp; 
That is, <font color="#000000"><i>s</i> = d(P<sub>0</sub>,P(<i>s</i>)) / d(P<sub>0</sub>,P<sub>1</sub>)</font>.&nbsp; 
Further, if <font color="#000000"><i>s</i>&lt;0</font> then <font color="#000000">
P(<i>s</i>)</font> is outside the segment on the <font color="#000000">P<sub>0</sub></font> 
side, and if <font color="#000000"><i>s</i>&gt;1</font> then <font color="#000000">
P(<i>s</i>)</font> is outside the segment on the <font color="#000000">P<sub>1</sub></font> 
side.</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Pic_parametric.gif" width="250" height="168"></p>
<p align="left">Let two lines be given by equations:<font color="#000000"> P(<i>s</i>) 
= P<sub>0 </sub>+ <i>s </i>(P<sub>1</sub><font face="Symbol">-</font>P<sub>0</sub>)</font> 
and <font color="#000000">Q(<i>t</i>) = Q<sub>0 </sub>+ <i>t </i>(Q<sub>1</sub><font face="Symbol">-</font>Q<sub>0</sub>)</font>, 
either or both of which could be a finite segment or a&nbsp; ray.&nbsp; These 
lines are parallel when and only when their directions are collinear, namely 
when the two vectors <font color="#000000"><b>u</b>=P<sub>1</sub><font face="Symbol">-</font>P<sub>0</sub></font> 
and <font color="#000000"><b>v</b>=Q<sub>1</sub><font face="Symbol">-</font>Q<sub>0</sub></font> 
are linearly related as <font color="#000000"><b>u</b>=C<b>v</b></font> for some 
real number <font color="#000000">C</font>.&nbsp; For <font color="#000000"><b>u</b>=(<i>u</i><sub><i>k</i></sub>)</font> 
and <font color="#000000"><b>v</b>=(<i>v</i><sub><i>k</i></sub>)</font>, this 
means that all ratios <font color="#000000"><i>u<sub>k</sub></i>/<i>v<sub>k</sub></i></font> 
have the same value, or that <font color="#000000"><i>u</i><sub>1</sub>/<i>v</i><sub>1</sub>=<i>u</i><sub><i>k</i></sub>/<i>v</i><sub><i>k</i></sub>
</font>for all <font color="#000000"><i>k</i></font>, which is equivalent to the 
conditions that all <font color="#000000"><i>u</i><sub>1</sub><i>v<sub>k</sub></i><font face="Symbol">-</font><i>u<sub>k</sub>v</i><sub>1</sub>=0</font>.&nbsp; 
In 2D, with <font color="#000000"><b>u</b>=(<i>u</i><sub>1</sub>,<i>u</i><sub>2</sub>)</font> 
and <font color="#000000"><b>v</b>=(<i>v</i><sub>1</sub>,<i>v</i><sub>2</sub>)</font>, 
this is the&nbsp; <b><i>perp</i></b> <b><i>product</i></b> [Hill, 1994] 
condition <font color="#000000"><b>u</b><font face="Symbol" color="#000000"><sup>^
</sup></font><b>· v </b>= <i>u</i><sub>1</sub><i>v</i><sub>2</sub><font face="Symbol">-</font><i>u</i><sub>2</sub><i>v</i><sub>1</sub> 
= 0&nbsp; </font>where <font color="#000000"><b>u</b><font face="Symbol" color="#000000"><sup>^</sup></font>=(<font face="Symbol">-</font><i>u</i><sub>2</sub>,<i>u</i><sub>1</sub>)</font> 
is perpendicular to <b><font color="#000000">u</font></b> ("<font face="Symbol" color="#000000"><sup>^</sup></font>" 
is called the <b><i>perp operator</i></b>).&nbsp;&nbsp; This condition says that 
two lines in the Euclidean plane are parallel when they are both perpendicular 
to the same direction <font color="#000000"><b>u</b><font face="Symbol" color="#000000"><sup>^</sup></font></font>.&nbsp; 
When true, the two lines are either coincident or do not intersect at all.</p>
<p align="left">Coincidence is easily checked by testing if a point on one line, 
say <font color="#000000">P<sub>0</sub></font>, also lies on the other line
<font color="#000000">Q(t)</font>.&nbsp;&nbsp; That is, there exists a
<font color="#000000"><i>t</i><sub>0</sub></font> such that:
<font color="#000000">P<sub>0</sub>=Q(<i>t</i><sub>0</sub>)=Q<sub>0</sub>+<i>t</i><sub>0</sub><b>v</b></font>.&nbsp; 
If <font color="#000000"><b>w</b>=(<i>w<sub>k</sub></i>)=P<sub>0</sub><font face="Symbol">-</font>Q<sub>0</sub></font>, 
then this is equivalent to the condition that <font color="#000000"><b>w</b>=<i>t</i><sub>0</sub><b>v</b></font> 
for some <font color="#000000">t<sub>0</sub></font> which is the same as
<font color="#000000"><i>w</i><sub>1</sub><i>v<sub>k</sub></i><font face="Symbol">-</font><i>w<sub>k</sub>v</i><sub>1</sub>=0</font> 
for all <font color="#000000"><i>k</i></font>.&nbsp; In 2D, this is the perp 
product condition: <font color="#000000"><b>w</b><font face="Symbol" color="#000000"><sup>^
</sup></font><b>· v </b>= <i>w</i><sub>1</sub><i>v</i><sub>2</sub><font face="Symbol">-</font><i>w</i><sub>2</sub><i>v</i><sub>1
</sub>= 0</font>.&nbsp; If these conditions hold, one can solve for
<font color="#000000"><i>t</i><sub>0</sub></font>, and the infinite lines are 
coincident.&nbsp; If one line (but not the other) is a finite segment, then it 
is the coincident intersection.&nbsp; However, if both lines are finite 
segments, then they may (or may not) overlap.&nbsp; In this case, solve for
<font color="#000000"><i>t</i><sub>0</sub></font> and <font color="#000000"><i>t</i><sub>1</sub></font> 
such that <font color="#000000">P<sub>0</sub>=Q(<i>t</i><sub>0</sub>)</font> and
<font color="#000000">P<sub>1</sub>=Q(<i>t</i><sub>1</sub>)</font>.&nbsp; If the 
segment intervals <font color="#000000">[<i>t</i><sub>0</sub>,<i>t</i><sub>1</sub>]</font> 
and <font color="#000000">[0,1]</font> are disjoint, then there is no 
intersection.&nbsp; Otherwise, intersect the intervals (using max and min 
operations) to get <font color="#000000">[<i>r</i><sub>0</sub>,<i>r</i><sub>1</sub>] 
= [<i>t</i><sub>0</sub>,<i>t</i><sub>1</sub>] <font face="Symbol">Ç</font></font>
<font color="#000000">[0,1]</font>.&nbsp; Then the intersection segment is
<font color="#000000">Q(<i>r</i><sub>0</sub>)Q(<i>r</i><sub>1</sub>) = P<sub>0</sub>P<sub>1</sub>
<font face="Symbol">Ç</font> Q<sub>0</sub>Q<sub>1</sub></font>.&nbsp; This works 
in any dimension.</p>
<p align="left">When the two lines are not parallel, they may intersect in a 
unique point.&nbsp; In 2D Euclidean space, they always intersect.&nbsp; In 
higher dimensions they may miss each other and not intersect.&nbsp; But if they 
do intersect, then their linear projections onto a 2D plane will also intersect.&nbsp; 
So, one can simply restrict to two coordinates (for which <b>
<font color="#000000">u</font></b> or <b><font color="#000000">v</font></b> are 
nonzero), compute the 2D intersection point <font face="Symbol" color="#000000">
I</font> at <font color="#000000">P(<i>s</i><font face="Symbol"><sub>I</sub></font>)
</font>and<font color="#000000"> Q(<i>t</i><font face="Symbol"><sub>I</sub></font>)</font> 
for those two coordinates, and then test if <font color="#000000">P(<i>s</i><font face="Symbol"><sub>I</sub></font>)=Q(<i>t</i><font face="Symbol"><sub>I</sub></font>)</font> 
for all coordinates.&nbsp; To compute the 2D intersection point
<font face="Symbol" color="#000000">I=</font><font color="#000000">P(<i>s</i><font face="Symbol"><sub>I</sub></font>)=Q(<i>t</i><font face="Symbol"><sub>I</sub></font>)</font>, 
consider the two lines and the associated vectors in the diagram:</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Pic_line-line.gif" width="330" height="178"></p>
<p align="left">To determine <font color="#000000"><i>s</i><font face="Symbol"><sub>I</sub></font></font>, 
we have the vector equality <font color="#000000">P(<i>s</i>)</font><font face="Symbol" color="#000000">-</font><font color="#000000">Q<sub>0
</sub>= <b>w </b>+ <i>s</i><b>u</b></font><font face="Symbol" color="#000000"><sup>&nbsp;
</sup></font>where <font color="#000000"><b>w</b>=P<sub>0</sub><font face="Symbol">-</font>Q<sub>0</sub></font>.&nbsp;&nbsp; 
At the intersection point, the vector <font color="#000000">P(<i>s</i>)</font><font face="Symbol" color="#000000">-</font><font color="#000000">Q<sub>0</sub></font> 
is perpendicular to <font color="#000000"><b>v</b><font face="Symbol" color="#000000"><sup>^</sup></font></font>, 
and this is equivalent to the perp product condition that <font color="#000000">
<b>v</b><font face="Symbol"><sup>^ </sup></font><b>· </b>(<b>w</b>+<i>s</i><b>u</b>) 
= 0</font>.&nbsp; Solving this equation, we get:</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Eqn_line-line1.gif" width="210" height="60"></p>
<p align="left">Note that the denominator <font color="#000000"><b>v</b><sup><font face="Symbol">^</font></sup>
<b>· u</b> = 0 </font>only when the lines are parallel as previously discussed.&nbsp; 
Similarly, solving for <font color="#000000">Q(<i>t</i><font face="Symbol"><sub>I</sub></font>)</font>, 
we get:</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Eqn_line-line2.gif" width="198" height="60"></p>
<p align="left">The denominators are the same up to sign, since
<font color="#000000"><b>u</b><font face="Symbol"><sup>^</sup></font><b>·v </b>=
<font face="Symbol">-</font><b>v</b><font face="Symbol"><sup>^</sup></font><b>·u</b></font>, 
and should only be computed once if we want to know both <font color="#000000">
<i>s</i><font face="Symbol"><sub>I</sub></font></font> and <font color="#000000">
<i>t</i><sub><font face="Symbol">I</font></sub></font>.</p>
<p align="left">If one of the two lines is a finite segment (or a ray), say
<font color="#000000">P<sub>0</sub>P<sub>1</sub></font>, then the intersect 
point is inside the segment only when <font color="#000000">0&lt;=<i>s</i><font face="Symbol"><sub>I</sub></font>&lt;=1 
(or <i>s</i><font face="Symbol"><sub>I</sub></font>&gt;=0 for a ray)</font>.&nbsp; 
If both lines are segments, then both solution parameters, <font color="#000000">
<i>s</i><font face="Symbol"><sub>I</sub></font></font> and <font color="#000000">
<i>t</i><sub><font face="Symbol">I</font></sub></font>, must be in the
<font color="#000000">[0,1]</font> interval for the segments to intersect.&nbsp; 
Although this sounds simple enough, the code for the intersection of two 
segments is a bit delicate since many special cases need to be checked (see our 
implementation <a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104B.htm#intersect2D_SegSeg()"><font face="Courier" size="2">
intersect2D_2Segments()</font></a>).</p>
<h2 align="left" style="text-align: left"><b><a name="Plane Intersections"></a>
Plane Intersections</b></h2>
<p align="left">Planes are represented as shown in Algorithm 4 
about the <a href="http://softsurfer.com/Archive/algorithm_0104/algorithm_0104.htm">Distance of a Point to a Plane</a>.</p>
<h3 style="text-align: left"><b><a name="Line-Plane Intersection"></a>Line-Plane 
Intersection</b></h3>
<p style="text-align: left">In 3D, a line <b><font color="#000000">L</font></b> 
is either parallel to a plane <b><font face="Symbol" color="#000000">p</font></b> 
or intersects it in a single point.&nbsp; Let <b><font color="#000000">L</font></b> 
be given by the parametric equation: <font color="#000000">P(<i>s</i>) = P<sub>0
</sub>+ <i>s</i>(P<sub>1</sub><font face="Symbol">-</font>P<sub>0</sub>) = P<sub>0
</sub>+ <i>s</i><b>u</b></font>, and the plane <b>
<font face="Symbol" color="#000000">p</font></b> be given by the point
<font color="#000000">V<sub>0</sub></font> on it and it's normal vector
<font color="#000000"><b>n</b></font>.&nbsp; We first check if <b>
<font color="#000000">L</font></b> is parallel to
<font face="Symbol" color="#000000"><b>p</b></font> by testing if
<font color="#000000"><b>n·u</b>=0</font> which means that the line direction 
vector <font color="#000000"><b>u</b></font> is perpendicular to the plane 
normal <b><font color="#000000">n</font></b>.&nbsp; If this is true, then <b>
<font color="#000000">L</font></b> and <font face="Symbol" color="#000000"><b>p</b></font> 
are parallel and either never intersect or else <font color="#000000"><b>L</b></font> 
lies totally in the plane <b><font face="Symbol" color="#000000">p</font></b>.&nbsp; 
Disjointness or coincidence can be determined by testing whether any specific 
point of <b><font color="#000000">L</font></b>, say <font color="#000000">P<sub>0</sub></font>, 
is contained in <b><font face="Symbol" color="#000000">p</font><font face="Symbol">,</font></b> 
that is whether it satisfies the implicit line equation: <font color="#000000">
<b>n·</b>(P<font face="Symbol">-</font>V<sub>0</sub>) = 0</font>.</p>
<p style="text-align: left">If the line and plane are not parallel, then <b>
<font color="#000000">L</font></b> and <font face="Symbol" color="#000000"><b>p</b></font> 
intersect in a unique point <font color="#000000">P(<i>s</i><font face="Symbol"><sub>I</sub></font>)</font> 
which is computed using a method similar to the one for the intersection of two 
lines in 2D.&nbsp; Consider the diagram:</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Pic_line-plane.gif" width="350" height="223"></p>
<p align="left">At the intersect point, the vector <font color="#000000">P(<i>s</i>)</font><font face="Symbol" color="#000000">-</font><font color="#000000">V<sub>0
</sub>= <b>w</b>+<i>s</i><b>u,</b></font><sup><font face="Symbol" color="#000000">&nbsp;
</font></sup>where <font color="#000000"><b>w</b>=P<sub>0</sub><font face="Symbol">-</font>V<sub>0</sub></font>, 
is perpendicular to <font color="#000000"><b>n</b></font>.&nbsp; This is 
equivalent to the dot product condition: <font color="#000000"><b>n · </b>(<b>w</b>+<i>s</i><b>u</b>) 
= 0</font>.&nbsp; Solving we get:</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Eqn_line-plane.gif" width="391" height="56"></p>
<p align="left">If the line <b><font color="#000000">L</font></b> is a finite 
segment from <font color="#000000">P<sub>0</sub></font> to <font color="#000000">
P<sub>1</sub></font>, then one just has to check that <font color="#000000">0&lt;=<i>s</i><font face="Symbol"><sub>I</sub></font>&lt;=1</font> 
to verify that there is an intersection between the segment and the plane.&nbsp; 
For a positive ray, there is an intersection with the plane when
<font color="#000000"><i>s</i><font face="Symbol"><sub>I</sub></font></font>&gt;=<font color="#000000">0</font>.</p>
<h3><b><a name="Intersection of 2 Planes"></a>Intersection of 2 Planes</b></h3>
<p style="text-align: left">In 3D, two planes <b>
<font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>1</sub></font> 
and <b><font face="Symbol" color="#000000">p</font></b><sub><font color="#000000">2</font></sub> 
are either parallel or they intersect in a single straight line <b>
<font color="#000000">L</font></b>.&nbsp; Let <b>
<font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub><i>i</i></sub> 
(<i>i</i>=1,2)</font> be given by a point <font color="#000000">V<i><sub>i</sub></i></font> 
plus a normal vector <font color="#000000"><b>n</b><sub><i>i</i></sub></font>, 
and have an implicit equation: <font color="#000000"><b>n</b><sub><i>i </i>
</sub><b>· </b>P +<i> d</i><sub><i>i </i></sub>= 0</font>.&nbsp; The planes <b>
<font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>1</sub></font> 
and <b><font face="Symbol" color="#000000">p</font></b><sub><font color="#000000">2</font></sub> 
are parallel whenever their normal vectors <font color="#000000"><b>n</b><sub>1</sub></font> 
and <font color="#000000"><b>n</b><sub>2</sub></font> are parallel, and this is 
equivalent to the condition that: <font color="#000000"><b>n</b><sub>1</sub>×<b>n</b><sub>2
</sub>= 0</font>.&nbsp; In software, one usually tests if&nbsp;
<font color="#000000"><b>|n</b><sub>1</sub>×<b>n</b><sub>2</sub><b>| </b>&lt;<i>
<font face="Symbol">d</font></i></font>&nbsp; where division by
<font color="#000000"><i><font face="Symbol">d</font></i></font> would cause 
overflow, and uses this as the robust condition for <font color="#000000"><b>n</b><sub>1</sub></font> 
and <font color="#000000"><b>n</b><sub>2</sub></font> being parallel.&nbsp; When 
not parallel, <font color="#000000"><b>u </b>=<b> n</b><sub>1</sub>×<b>n</b><sub>2
</sub><font face="Symbol" size="4">³</font><font size="4"> </font>
<font face="Symbol"><i>d</i><font size="4"> &gt; </font></font>0</font> is a 
direction vector for the intersection line <b><font color="#000000">L</font></b> 
since <font color="#000000"><b>u</b></font> is perpendicular to both
<font color="#000000"><b>n</b><sub>1</sub></font> and <font color="#000000"><b>n</b><sub>2</sub></font>, 
and thus is parallel to both planes as shown in the following diagram.&nbsp; If
<b>|u|</b> is small, it is best to scale it so that <b>|u| </b>= 1, making <b>u</b> 
a unit direction vector.</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Pic_2-planes.gif" width="300" height="236"></p>
<p style="text-align: left">After computing <font color="#000000"><b>n</b><sub>1</sub>×<b>n</b><sub>2</sub> 
(3 adds + 6 multiplies)</font>, to fully determine the intersection line, we 
still need to find a specific point on it; that is, we need to find a point
<font color="#000000">P<sub>0</sub>=(<i>x</i><sub>0</sub>,<i>y</i><sub>0</sub>,<i>z</i><sub>0</sub>)</font> 
that lies in both planes.&nbsp; We can do this by finding a common solution of 
the implicit equations for <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>1</sub></font> 
and <b><font face="Symbol" color="#000000">p</font></b><sub><font color="#000000">2</font></sub>.&nbsp; 
But there are only two equations in the 3 unknowns since the point
<font color="#000000">P<sub>0</sub></font> can lie anywhere on the 1-dimensional 
line <b><font color="#000000">L</font></b> which is another degree of freedom.&nbsp; 
So we need another constraint to solve for a specific <font color="#000000">P<sub>0</sub></font>.&nbsp; 
There are a number of ways this could be done:</p>
<p style="text-align: left"><b>(A) Direct Linear Equation.</b>&nbsp; One could 
set one coordinate to zero, say <font color="#000000"><i>z</i><sub>0</sub>=0</font>, 
and then solve for the other two.&nbsp; But this will only work when <b>
<font color="#000000">L</font></b> intersects the plane <font color="#000000">
<i>z</i><sub>0</sub>=0.&nbsp; This is will be true when the <i>z</i>-coordinate
<i>u</i><sub><i>z</i></sub> of <b>u</b> =(<i>u<sub>x</sub>,u<sub>y</sub>,u</i><sub><i>z</i></sub>) 
is nonzero.&nbsp; So, one must first select a nonzero coordinate of <b>u</b>, 
and then set that coordinate of P<sub>0</sub> = 0.&nbsp; One should choose the 
coordinate with the largest absolute value, as this will give the most robust 
computations.&nbsp; Suppose that <i>u<sub>z</sub></i><font face="Symbol" size="4">¹</font>0, 
then P<sub>0</sub>=(<i>x</i><sub>0</sub>,<i>y</i><sub>0</sub>,0) lies on </font>
<b><font color="#000000">L</font></b><font color="#000000">.&nbsp; Solving the 
two equations: <i>a</i><sub>1</sub><i>x</i><sub>0</sub><i>+b</i><sub>1</sub><i>y</i><sub>0</sub><i>+d</i><sub>1</sub>=0 
and <i>a</i><sub>2</sub><i>x</i><sub>0</sub><i>+b</i><sub>2</sub><i>y</i><sub>0</sub><i>+d</i><sub>2</sub>=0, 
we get:</font></p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Eqn_2planesP0-A.gif" width="306" height="56"></p>
<p align="left">and the parametric equation of <b>L</b> is:</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Eqn_2planes-A.gif" width="330" height="123"></p>
<p align="left">The denominator here is equal to the non-zero 3rd coordinate of
<b>u</b>.&nbsp; So, ignoring the test for a nonzero coordinate, and equating 
division with multiplication, the total operations for this solution = 5 adds + 
12 multiplies.</p>
<p style="text-align: left"><b>(B) Line Intersect Point.</b>&nbsp; If one knows 
a specific line in one plane (for example, two points in the plane), and this 
line intersects the other plane, then its point of intersection "<font color="#000000">I"</font> 
will lie in both planes.&nbsp; Thus, this will be a point on the line of 
intersection for the two planes, and the parametric equation of <b>L</b> is: P(<i>s</i>) 
= I + <i>s </i>(<font color="#000000"><b>n</b><sub>1</sub>×<b>n</b><sub>2</sub></font>).&nbsp; 
To compute <font color="#000000"><b>n</b><sub>1</sub>×<b>n</b><sub>2</sub></font> 
and the intersection point (given the line) has a total number of operations = 
11 adds + 19 multiplies.</p>
<p style="text-align: left">One way of constructing a line in one plane that 
must intersect the other plane is to project one plane's normal vector onto the 
other plane.&nbsp; This gives a line that must always be orthogonal to the line 
of the planes' intersection.&nbsp; So, the projection of <font color="#000000">
<b>n</b><sub>2</sub></font> on <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>1</sub></font> 
defines a line that intersects <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>2</sub></font> 
in the sought for point <font color="#000000">P<sub>0</sub></font> on <b>L</b>.&nbsp; 
More specifically, project the two points <b>0</b>=(0,0,0) and
<font color="#000000"><b>n</b><sub>2</sub></font>=(nx<sub>2</sub>,ny<sub>2</sub>,nz<sub>2</sub>) 
to <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>1</sub></font>(<b>0</b>) 
and <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>1</sub></font>(<font color="#000000"><b>n</b><sub>2</sub></font>) 
respectively.&nbsp; Then the projected line in <b>
<font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>1</sub></font> 
is <b>L</b><sub>1</sub>: Q(t) = <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>1</sub></font>(<b>0</b>) 
+ t <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>1</sub></font>(<font color="#000000"><b>n</b><sub>2</sub></font>), 
and intersection of it with <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>2</sub></font> 
can be computed.&nbsp; In the most efficient case, where both
<font color="#000000"><b>n</b><sub>1</sub></font> and <font color="#000000"><b>n</b><sub>2</sub></font> 
are unit normal vectors and the constant <b><font face="Symbol" color="#000000">
p</font></b><font color="#000000"><sub>1</sub></font>(<b>0</b>) is pre-stored, 
the total operations = 17 adds + 22 multiplies.</p>
<p style="text-align: left"><b>(C)</b> <b>3 Plane Intersect Point.</b>&nbsp; One 
can select a third plane <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>3</sub></font> 
with an implicit equation <font color="#000000"><b>n</b><sub>3 </sub><b>· </b>P 
= 0</font> where the normal vector <font color="#000000"><b>n</b><sub>3 </sub>=<b> 
n</b><sub>1</sub>×<b>n</b><sub>2</sub></font> and <font color="#000000"><i>d</i><sub>3</sub>=0</font> 
(meaning it passes through the origin).&nbsp; This always works since: (1) <b>
<font color="#000000">L</font></b> is perpendicular to <b>
<font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>3</sub></font> 
and thus intersects it, and (2) the vectors <font color="#000000"><b>n</b><sub>1</sub>,<b> 
n</b><sub>2</sub>, and <b>n</b><sub>3</sub></font> are linearly independent.&nbsp; 
Thus the planes <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>1</sub></font>,
<font face="Symbol" color="#000000"><b>p</b></font><sub><font color="#000000">2</font></sub> 
and <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>3</sub></font> 
intersect in a unique point <font color="#000000">P<sub>0</sub></font> which 
must be on <b><font color="#000000">L</font></b>.&nbsp; Using the formula for 
the intersection of 3 planes (see the next section), where <font color="#000000">
<i>d</i><sub>3</sub>=0</font> for <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>3</sub></font>, 
we get:</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Eqn_2planesP0-C.gif" width="406" height="116"></p>
<p align="left">and the parametric equation of <b>L</b> is:</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Eqn_2planes-C.gif" align="absmiddle" width="393" height="58">.</p>
<p align="left">The number of operations for this solution = 11 adds + 23 
multiplies.</p>
<p align="left">This formula can be simplified when <font color="#000000"><b>n</b><sub>1</sub></font> 
and <font color="#000000"><b>n</b><sub>2</sub></font> are unit normal vectors, 
and <font color="#000000"><b>n</b><sub>1 </sub><b>· n</b><sub>2</sub> = cos
<font face="Symbol">q</font> where <font face="Symbol">q</font> is the angle 
between these vectors.&nbsp; Then, <b>n</b><sub>1 </sub><b>· n</b><sub>1</sub> =
<b>n</b><sub>2 </sub><b>· n</b><sub>2</sub> = 1, and <b>|n</b><sub>1</sub>×<b>n</b><sub>2</sub><b>|</b><sup>2</sup> 
= sin<sup>2</sup> <font face="Symbol">q</font> = 1 </font>
<font face="Symbol" color="#000000">-</font><font color="#000000"> cos<sup>2</sup>
<font face="Symbol">q</font> = 1 </font><font face="Symbol" color="#000000">-</font><font color="#000000"> 
(<b>n</b><sub>1 </sub><b>· n</b><sub>2</sub>)<sup>2</sup> for the denominator.&nbsp; 
Finally, we use the identity for right-association of the cross-product; namely, 
for any three (3D) vectors <b>a</b>, <b>b</b>, and <b>c</b>, it is always true 
that: <b>a</b>×(<b>b</b>×<b>c</b>) = (<b>a</b><sub> </sub><b>· c</b>)<b>b</b>
</font><font face="Symbol" color="#000000">-</font><font color="#000000"> (<b>a</b><sub>
</sub><b>· b</b>)<b>c</b>.&nbsp; Applying this to the numerator, and 
simplifying, we get: (<i>d</i><sub>2</sub><b>n</b><sub>1</sub></font><font face="Symbol" color="#000000">-</font><font color="#000000"><i>d</i><sub>1</sub><b>n</b><sub>2</sub>)×(<b>n</b><sub>1</sub>×<b>n</b><sub>2</sub>) 
= (<i>d</i><sub>2</sub></font><font face="Symbol" color="#000000"> </font>
<font color="#000000">cos <font face="Symbol">q </font></font>
<font face="Symbol" color="#000000">-</font><font color="#000000"><i> d</i><sub>1</sub>)
<b>n</b><sub>1</sub> + (<i>d</i><sub>1</sub></font><font face="Symbol" color="#000000">
</font><font color="#000000">cos <font face="Symbol">q </font></font>
<font face="Symbol" color="#000000">-</font><font color="#000000"><i> d</i><sub>2</sub>)
<b>n</b><sub>2</sub> .&nbsp; Thus,</font></p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Eqn_2planes-C2.gif" width="551" height="56"></p>
<p align="left">This solution expresses the point <font color="#000000">P<sub>0</sub></font> 
on <b>L</b> as a linear combination of the vectors <font color="#000000"><b>n</b><sub>1</sub></font> 
and <font color="#000000"><b>n</b><sub>2</sub></font> that are a basis spanning 
the plane <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>3</sub></font> 
through the origin.&nbsp; The number of operations = 11 adds + 20 multiplies.</p>
<p align="left">But the <span style="font-weight: 400">bottom line</span> is 
that <i><b>the most efficient method is the direct solution (A)</b></i> that 
only uses 5 adds + 12 multiplies to compute the equation of the intersection 
line.</p>
<p align="left">[Footnote: I would like to acknowledge a fruitful email exchange 
with Nick Polyayev in July 2001 discussing alternative methods for determining 
the intersection line for 2 planes.&nbsp; This resulted in a greatly improved 
presentation of this section.]</p>
<h3 style="text-align: left"><b><a name="Intersection of 3 Planes"></a>
Intersection of 3 Planes</b></h3>
<p style="text-align: left">In 3D, three planes <b><font face="Symbol">p</font></b><sub>1</sub>,
<b><font face="Symbol">p</font></b><sub>2</sub> and <b><font face="Symbol">p</font></b><sub>3</sub> 
can intersect (or not) in the following ways:</p>
<div align="center">
  <center>
  <table border="0" width="130">
    <tbody><tr>
      <td><img border="0" src="./Intersection of Lines and Planes_files/trans5x260.gif" width="260" height="5"></td>
      <td><img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5"></td>
      <td><img border="0" src="./Intersection of Lines and Planes_files/trans5x120.gif" width="120" height="5"></td>
      <td><img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5"></td>
      <td><img border="0" src="./Intersection of Lines and Planes_files/trans5x200.gif" width="200" height="5"></td>
    </tr>
    <tr>
      <td><u><b>Geometric Relation</b></u></td>
      <td></td>
      <td><u><b>Intersection</b></u></td>
      <td></td>
      <td><u><b>Algebraic Condition</b></u></td>
    </tr>
    <tr>
      <td>All 3 planes are parallel</td>
      <td></td>
      <td></td>
      <td></td>
      <td><b>n</b><sub><i>j</i></sub>×<b>n</b><sub><i>k</i></sub>=0 for all <i>
      j,k</i>=1,3</td>
    </tr>
    <tr>
      <td><img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5">They 
      coincide</td>
      <td></td>
      <td>A plane</td>
      <td></td>
      <td><b>n</b><sub>1</sub><b>·</b>V<sub>1</sub>=<b>n</b><sub>1</sub><b>·</b>V<sub>2</sub>=<b>n</b><sub>1</sub><b>·</b>V<sub>3</sub></td>
    </tr>
    <tr>
      <td><img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5">They are 
      disjoint</td>
      <td></td>
      <td>None</td>
      <td></td>
      <td><b>n</b><sub>1</sub><b>·</b>V<sub>1</sub><font face="Symbol" size="4">¹</font><b>n</b><sub>1</sub><b>·</b>V<sub>2</sub><font face="Symbol" size="4">¹</font><b>n</b><sub>1</sub><b>·</b>V<sub>3</sub><font face="Symbol" size="4">¹</font><b>n</b><sub>1</sub><b>·</b>V<sub>1</sub></td>
    </tr>
    <tr>
      <td colspan="5">
      <hr>
      </td>
    </tr>
    <tr>
      <td>Just two planes are parallel, and<br>
      the 3rd plane cuts each in a line<br>
      [Note: the 2 parallel planes may coincide]</td>
      <td></td>
      <td><br>
      2 parallel lines<br>
      [coincide =&gt; 1 line]</td>
      <td></td>
      <td>Only one <b>n</b><sub><i>j</i></sub>×<b>n</b><sub><i>k</i></sub>=0 for
      <i>j</i><font face="Symbol" size="4">¹</font><i>k</i></td>
    </tr>
    <tr>
      <td colspan="5">
      <hr>
      </td>
    </tr>
    <tr>
      <td>No two planes are parallel, so pairwise they intersect in 3 lines</td>
      <td></td>
      <td></td>
      <td></td>
      <td><b>n</b><sub><i>j</i></sub>×<b>n</b><sub><i>k</i></sub><font face="Symbol" size="4">¹</font>0 
      for all <i>j</i><font face="Symbol" size="4">¹</font><i>k</i></td>
    </tr>
    <tr>
      <td><img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5">The 
      intersection lines are parallel</td>
      <td></td>
      <td></td>
      <td></td>
      <td><b>n</b><sub>1</sub><b>·</b>(<b>n</b><sub>2</sub>×<b>n</b><sub>3</sub>)=0</td>
    </tr>
    <tr>
      <td><img border="0" src="./Intersection of Lines and Planes_files/trans5x050.gif" width="50" height="5">They 
      coincide</td>
      <td></td>
      <td>1 line</td>
      <td></td>
      <td>test a point from one line</td>
    </tr>
    <tr>
      <td><img border="0" src="./Intersection of Lines and Planes_files/trans5x050.gif" width="50" height="5">They are 
      disjoint</td>
      <td></td>
      <td>3 parallel lines</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td><img border="0" src="./Intersection of Lines and Planes_files/trans5x025.gif" width="25" height="5">No 
      intersection lines are parallel</td>
      <td></td>
      <td>A unique point</td>
      <td></td>
      <td><b>n</b><sub>1</sub><b>·</b>(<b>n</b><sub>2</sub>×<b>n</b><sub>3</sub>)<font face="Symbol" size="4">¹</font>0</td>
    </tr>
    <tr>
      <td colspan="5">
      <hr>
      </td>
    </tr>
  </tbody></table>
  </center>
</div>
<p style="text-align: left">As shown in the illustrations:</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Pic_3-planes.gif" width="400" height="220"></p>
<p style="text-align: left">One should test for the most frequent case of a 
unique intersect point first, namely that <font color="#000000"><b>n</b><sub>1</sub><b>·</b>(<b>n</b><sub>2</sub>×<b>n</b><sub>3</sub>)<font face="Symbol" size="4">¹</font>0</font>, 
since this excludes the other cases.&nbsp; When the intersection is a unique 
point, it is given by the formula:</p>
<p align="center"><img border="0" src="./Intersection of Lines and Planes_files/Eqn_3planes.gif" width="341" height="56"></p>
<p align="left">which can verified by showing that this <font color="#000000">P<sub>0</sub></font> 
satisfies the parametric equations for <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>1</sub></font>,
<font face="Symbol" color="#000000"><b>p</b></font><sub><font color="#000000">2</font></sub> 
and <b><font face="Symbol" color="#000000">p</font></b><font color="#000000"><sub>3</sub></font>.</p>
<p align="left">However, there can be a problem with the robustness of this 
computation when the denominator <font color="#000000"><b>n</b><sub>1</sub><b>·</b>(<b>n</b><sub>2</sub>×<b>n</b><sub>3</sub>)
</font>is very small.&nbsp; In this case, it would be best to get a robust line 
of intersection for two of the planes, and then compute the point where this 
line intersects the third plane.</p>
<h2 style="text-align: left"><b><font color="#800080"><br>
<a name="Implementations"></a>Implementations</font></b></h2>
<p style="text-align: left">Here are some sample "C++" implementations of these 
algorithms.&nbsp;</p>
<p style="text-align: left"><font face="Courier">// Copyright 2001, softSurfer (www.softsurfer.com)<br>
// This code may be freely used and modified for any purpose<br>
// providing that this copyright notice is included with it.<br>
// SoftSurfer makes no warranty for this code, and cannot be held<br>
// liable for any real or imagined damage resulting from its use.<br>
// Users of this code must verify correctness for their application.<br>
</font></p>
<p style="text-align: left"><font face="Courier">// Assume that classes are 
already given for the objects:<br>
//&nbsp;&nbsp;&nbsp; <b>Point</b> and <b>Vector</b> with<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; coordinates {float x, y, z;}<b><br>
</b>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; operators for:<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; == to test 
equality<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; != to test 
inequality<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Point&nbsp; 
= Point ± Vector<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vector = 
Point - Point<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vector = 
Scalar * Vector&nbsp;&nbsp;&nbsp; (scalar product)<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vector = 
Vector * Vector&nbsp;&nbsp;&nbsp; (3D cross product)<br>
//&nbsp;&nbsp;&nbsp; <b>Line</b> and <b>Ray</b> and <b>Segment</b> with defining 
points {Point P0, P1;}<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (a Line is infinite, Rays and 
Segments start at P0)<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (a Ray extends beyond P1, but a 
Segment ends at P1)<br>
//&nbsp;&nbsp;&nbsp; <b>Plane</b> with a point and a normal {Point V0; Vector 
n;}<br>
//===================================================================<br>
</font></p>
<p style="text-align: left"><font face="Courier">#define SMALL_NUM&nbsp; 
0.00000001 // anything that avoids division overflow<br>
// dot product (3D) which allows vector operations in arguments<br>
#define dot(u,v)&nbsp;&nbsp; ((u).x * (v).x + (u).y * (v).y + (u).z * (v).z)<br>
#define perp(u,v)&nbsp; ((u).x * (v).y - (u).y * (v).x)&nbsp; // perp product 
(2D)<br>
&nbsp;</font></p>
<p style="text-align: left"><font face="Courier">//<a name="intersect2D_SegSeg()"></a>
<b>intersect2D_2Segments</b>(): the intersection of 2 finite 2D segments<br>
//&nbsp;&nbsp;&nbsp; Input:&nbsp; two finite segments S1 and S2<br>
//&nbsp;&nbsp;&nbsp; Output: *I0 = intersect point (when it exists)<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *I1 = 
endpoint of intersect segment [I0,I1] (when it exists)<br>
//&nbsp;&nbsp;&nbsp; Return: 0=disjoint (no intersect)<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1=intersect 
in unique point I0<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2=overlap 
in segment from I0 to I1<br>
int<br>
intersect2D_Segments( Segment S1, Segment S2, Point* I0, Point* I1 )<br>
{<br>
&nbsp;&nbsp;&nbsp; Vector&nbsp;&nbsp;&nbsp; u = S1.P1 - S1.P0;<br>
&nbsp;&nbsp;&nbsp; Vector&nbsp;&nbsp;&nbsp; v = S2.P1 - S2.P0;<br>
&nbsp;&nbsp;&nbsp; Vector&nbsp;&nbsp;&nbsp; w = S1.P0 - S2.P0;<br>
&nbsp;&nbsp;&nbsp; float&nbsp;&nbsp;&nbsp;&nbsp; D = perp(u,v);</font></p>
<p style="text-align: left"><font face="Courier">&nbsp;&nbsp;&nbsp; // test if 
they are parallel (includes either being a point)<br>
&nbsp;&nbsp;&nbsp; if (fabs(D) &lt; SMALL_NUM) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// S1 and S2 are parallel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (perp(u,w) != 0 || perp(v,w) != 0) 
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// they are NOT collinear<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // they are collinear or degenerate<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // check if they are degenerate 
points<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; float du = dot(u,u);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; float dv = dot(v,v);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (du==0 &amp;&amp; dv==0) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// both segments are points<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (S1.P0 != 
S2.P0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // they are distinct 
points<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
return 0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *I0 = S1.P0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// they are the same point<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (du==0) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// S1 is a single point<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if 
(inSegment(S1.P0, S2) == 0)&nbsp; // but is not in S2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
return 0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *I0 = S1.P0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (dv==0) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// S2 a single point<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if 
(inSegment(S2.P0, S1) == 0)&nbsp; // but is not in S1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
return 0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *I0 = S2.P0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // they are collinear segments - get 
overlap (or not)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; float t0, t1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// endpoints of S1 in eqn for S2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vector w2 = S1.P1 - S2.P0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (v.x != 0) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
t0 = w.x / v.x;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
t1 = w2.x / v.x;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
t0 = w.y / v.y;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
t1 = w2.y / v.y;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (t0 &gt; t1) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// must have t0 smaller than t1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
float t=t0; t0=t1; t1=t;&nbsp;&nbsp;&nbsp; // swap if not<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (t0 &gt; 1 || t1 &lt; 0) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;&nbsp;&nbsp;&nbsp;&nbsp; 
// NO overlap<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t0 = t0&lt;0? 0 : t0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// clip to min 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t1 = t1&gt;1? 1 : t1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// clip to max 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (t0 == t1) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// intersect is a point<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *I0 = S2.P0 + 
t0 * v;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // they overlap in a valid subsegment<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *I0 = S2.P0 + t0 * v;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *I1 = S2.P0 + t1 * v;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 2;<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; // the segments are skew and may intersect in a point<br>
&nbsp;&nbsp;&nbsp; // get the intersect parameter for S1<br>
&nbsp;&nbsp;&nbsp; float&nbsp;&nbsp;&nbsp;&nbsp; sI = perp(v,w) / D;<br>
&nbsp;&nbsp;&nbsp; if (sI &lt; 0 || sI &gt; 1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// no intersect with S1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;</font></p>
<p><font face="Courier">&nbsp;&nbsp;&nbsp; // get the intersect parameter for S2<br>
&nbsp;&nbsp;&nbsp; float&nbsp;&nbsp;&nbsp;&nbsp; tI = perp(u,w) / D;<br>
&nbsp;&nbsp;&nbsp; if (tI &lt; 0 || tI &gt; 1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// no intersect with S2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;</font></p>
<p><font face="Courier">&nbsp;&nbsp;&nbsp; *I0 = S1.P0 + sI * u;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// compute S1 intersect point<br>
&nbsp;&nbsp;&nbsp; return 1;<br>
}<br>
//===================================================================<br>
</font></p>
<p style="text-align: left"><font face="Courier">//<a name="inSegment()"></a> <b>
inSegment()</b>: determine if a point is inside a segment<br>
//&nbsp;&nbsp;&nbsp; Input:&nbsp; a point P, and a collinear segment S<br>
//&nbsp;&nbsp;&nbsp; Return: 1 = P is inside S<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 = P is 
not inside S<br>
int<br>
inSegment( Point P, Segment S)<br>
{<br>
&nbsp;&nbsp;&nbsp; if (S.P0.x != S.P1.x) {&nbsp;&nbsp;&nbsp; // S is not 
vertical<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (S.P0.x &lt;= P.x &amp;&amp; P.x &lt;= S.P1.x)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (S.P0.x &gt;= P.x &amp;&amp; P.x &gt;= S.P1.x)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;<br>
&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; else {&nbsp;&nbsp;&nbsp; // S is vertical, so test y 
coordinate<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (S.P0.y &lt;= P.y &amp;&amp; P.y &lt;= S.P1.y)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (S.P0.y &gt;= P.y &amp;&amp; P.y &gt;= S.P1.y)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;<br>
&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; return 0;<br>
}<br>
//===================================================================<br>
</font></p>
<p style="text-align: left"><font face="Courier">//<a name="intersect3D_SegPlane()"></a>
<b>intersect3D_SegmentPlane</b>(): intersect a segment and a plane<br>
//&nbsp;&nbsp;&nbsp; Input:&nbsp; S = a segment, and Pn = a plane = {Point V0; 
Vector n;}<br>
//&nbsp;&nbsp;&nbsp; Output: *I0 = the intersect point (when it exists)<br>
//&nbsp;&nbsp;&nbsp; Return: 0 = disjoint (no intersection)<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 = 
intersection in the unique point *I0<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 = the 
segment lies in the plane<br>
int<br>
intersect3D_SegmentPlane( Segment S, Plane Pn, Point* I )<br>
{<br>
&nbsp;&nbsp;&nbsp; Vector&nbsp;&nbsp;&nbsp; u = S.P1 - S.P0;<br>
&nbsp;&nbsp;&nbsp; Vector&nbsp;&nbsp;&nbsp; w = S.P0 - Pn.V0;<br>
<br>
&nbsp;&nbsp;&nbsp; float&nbsp;&nbsp;&nbsp;&nbsp; D = dot(Pn.n, u);<br>
&nbsp;&nbsp;&nbsp; float&nbsp;&nbsp;&nbsp;&nbsp; N = -dot(Pn.n, w);<br>
<br>
&nbsp;&nbsp;&nbsp; if (fabs(D) &lt; SMALL_NUM) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// segment is parallel to plane<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (N == 0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// segment lies in plane<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// no intersection<br>
&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; // they are not parallel<br>
&nbsp;&nbsp;&nbsp; // compute intersect param<br>
&nbsp;&nbsp;&nbsp; float sI = N / D;<br>
&nbsp;&nbsp;&nbsp; if (sI &lt; 0 || sI &gt; 1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// no intersection<br>
<br>
&nbsp;&nbsp;&nbsp; *I = S.P0 + sI * u;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// compute segment intersect point<br>
&nbsp;&nbsp;&nbsp; return 1;<br>
}<br>
//===================================================================<br>
</font></p>
<p style="text-align: left"><font face="Courier">//<a name="intersect3D_2Planes()"></a>
<b>intersect3D_2Planes()</b>: the 3D intersect of two planes<br>
//&nbsp;&nbsp;&nbsp; Input:&nbsp; two planes Pn1 and Pn2<br>
//&nbsp;&nbsp;&nbsp; Output: *L = the intersection line (when it exists)<br>
//&nbsp;&nbsp;&nbsp; Return: 0 = disjoint (no intersection)<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 = the two 
planes coincide<br>
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 = 
intersection in the unique line *L<br>
int<br>
intersect3D_2Planes( Plane Pn1, Plane Pn2, Line* L )<br>
{<br>
&nbsp;&nbsp;&nbsp; Vector&nbsp;&nbsp; u = Pn1.n * Pn2.n;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// cross product<br>
&nbsp;&nbsp;&nbsp; float&nbsp;&nbsp;&nbsp; ax = (u.x &gt;= 0 ? u.x : -u.x);<br>
&nbsp;&nbsp;&nbsp; float&nbsp;&nbsp;&nbsp; ay = (u.y &gt;= 0 ? u.y : -u.y);<br>
&nbsp;&nbsp;&nbsp; float&nbsp;&nbsp;&nbsp; az = (u.z &gt;= 0 ? u.z : -u.z);<br>
<br>
&nbsp;&nbsp;&nbsp; // test if the two planes are parallel<br>
&nbsp;&nbsp;&nbsp; if ((ax+ay+az) &lt; SMALL_NUM) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// Pn1 and Pn2 are near parallel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // test if disjoint or coincide<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vector&nbsp;&nbsp; v = Pn2.V0 - 
Pn1.V0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (dot(Pn1.n, v) == 0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// Pn2.V0 lies in Pn1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// Pn1 and Pn2 coincide<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// Pn1 and Pn2 are disjoint<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; // Pn1 and Pn2 intersect in a line<br>
&nbsp;&nbsp;&nbsp; // first determine max abs coordinate of cross product<br>
&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxc;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// max coordinate<br>
&nbsp;&nbsp;&nbsp; if (ax &gt; ay) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (ax &gt; az)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxc = 
1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else maxc = 3;<br>
&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; else {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (ay &gt; az)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxc = 
2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else maxc = 3;<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; // next, to get a point on the intersect line<br>
&nbsp;&nbsp;&nbsp; // zero the max coord, and solve for the other two<br>
&nbsp;&nbsp;&nbsp; Point&nbsp;&nbsp;&nbsp; iP;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// intersect point<br>
&nbsp;&nbsp;&nbsp; float&nbsp;&nbsp;&nbsp; d1, d2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// the constants in the 2 plane equations<br>
&nbsp;&nbsp;&nbsp; d1 = -dot(Pn1.n, Pn1.V0);&nbsp; // note: could be pre-stored 
with plane<br>
&nbsp;&nbsp;&nbsp; d2 = -dot(Pn2.n, Pn2.V0);&nbsp; // ditto<br>
<br>
&nbsp;&nbsp;&nbsp; switch (maxc) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// select max coordinate<br>
&nbsp;&nbsp;&nbsp; case 1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// intersect with x=0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iP.x = 0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iP.y = (d2*Pn1.n.z - d1*Pn2.n.z) / 
u.x;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iP.z = (d1*Pn2.n.y - d2*Pn1.n.y) / 
u.x;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>
&nbsp;&nbsp;&nbsp; case 2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// intersect with y=0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iP.x = (d1*Pn2.n.z - d2*Pn1.n.z) / 
u.y;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iP.y = 0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iP.z = (d2*Pn1.n.x - d1*Pn2.n.x) / 
u.y;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>
&nbsp;&nbsp;&nbsp; case 3:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
// intersect with z=0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iP.x = (d2*Pn1.n.y - d1*Pn2.n.y) / 
u.z;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iP.y = (d1*Pn2.n.x - d2*Pn1.n.x) / 
u.z;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iP.z = 0;<br>
&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; L-&gt;P0 = iP;<br>
&nbsp;&nbsp;&nbsp; L-&gt;P1 = iP + u;<br>
&nbsp;&nbsp;&nbsp; return 2;<br>
}<br>
//===================================================================<br>
</font></p>
<h2 style="text-align: left"><br>
<b><a name="References"></a>References</b></h2>
<p align="left"><font size="2">Foley, van Dam, Feiner &amp; Hughes,
<a href="http://www.amazon.com/exec/obidos/ASIN/0201848406/softsurfergeomet"><u>
Computer Graphics (2nd Edition in C)</u></a>, Section 3.12 "Clipping Lines" 
(1996)</font></p>
<p align="left"><font size="2">Francis Hill, "The Pleasures of 'Perp Dot' 
Products" in <u>
<a href="http://www.amazon.com/exec/obidos/ASIN/0123361559/softsurfergeomet">
Graphics Gems IV</a></u> (1994)<br>
[Note: the first critical definition has a typo, and should be: <b>a</b><font face="Symbol"><sup>^
</sup></font>= (<font face="Symbol">-</font>a<sub>y</sub>, a<sub>x</sub>).]</font></p>
<p style="text-align: left"><font size="2">Michael Mortenson, <u>
<a href="http://www.amazon.com/exec/obidos/ASIN/0831110023/softsurfergeomet">
Computer Graphics Handbook : Geometry and Mathematics</a></u> (1990)</font></p>
<p style="text-align: left"><font size="2">Joseph O'Rourke,
<a href="http://www.amazon.com/exec/obidos/ASIN/0521649765/softsurfergeomet">
Computational Geometry in C (2nd Edition)</a>, Chapter 7 "Search and 
Intersection" (1998)</font></p>

<!--msnavigation--></td></tr><!--msnavigation--></tbody></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td>

<hr color="#000000">
<p align="center"><font size="1" face="Arial" color="#C0C0C0">Copyright © 
2001-2006 softSurfer.&nbsp; All rights reserved.<br>
Email comments and suggestions to </font>
<font size="1" face="Arial" color="#008080">
<a href="mailto:feedback@softsurfer.com"><font color="#808080">
feedback@softsurfer.com</font></a></font></p>

</td></tr><!--msnavigation--></tbody></table></body></html>